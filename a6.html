<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, maximum-scale=1.0" />

    <title>Sofia Walton's HCDE 439 Physical Computing Page!</title>

    <link href="style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
   
    <header>
    <h1>Sofia's Assignment 6!</h1>
      <p>Here is all the documentation for assignment 6!<br>
      </header>

      <main>
        <section>
        <h2>Schematic</h2>
        <img src="a6schematic.png" class="Schematic.jpeg" />
        <p>Image of my schematic for the circuit & resistance calculation.</p>
        </section>

        <section>
          <h2>'Talking to the web!' Circuit Documentation</h2>
          <img src="a6pic.jpeg" class="blink1.jpeg" />
          <p>
            This is my 'Talking to the Web!' circuit. 
          </p>
        </section>

        <section>
          <h2>.ino code</h2>
          <pre>
            <code>
              // This code reads joystick input and controls three different LEDs based on serial commands from my computer

              const int Xpin = A0; // Joystick X-axis connected to A0 pin
              const int Ypin = A1; // Joystick Y-axis connected to A1 pin

              const int greenLED = 8; // Green LED pin connected to digital pin 8
              const int redLED = 12; // Red LED pin connected to digital pin 12
              const int yellowLED = 4; // Yellow LED pin connected to digital pin 4

              void setup() {
                Serial.begin(9600); // Start serial communication at 9600 baud rate
                pinMode(greenLED, OUTPUT); // Set green LED pin as output
                pinMode(redLED, OUTPUT); // Set red LED pin as output
                pinMode(yellowLED, OUTPUT); // Set yellow LED pin as output
              }

              void loop(){
                  // Read joystick values
                  int xValue = analogRead(Xpin); // Read X-axis value (0-1023)
                  int yValue = analogRead(Ypin); // Read Y-axis value (0-1023)
                 
                  // Send joystick values over serial to .js file
                  Serial.print(xValue);
                  Serial.print(","); // Seperates with comma
                  Serial.print(yValue);
                  Serial.print(","); // Seperates with comma
                
                  // Check for incoming serial commands from .js file
                  if(Serial.available()){
                      String command = Serial.readStringUntil('\n');
                      command.trim(); // Remove any trailing newline or spaces
                  
                      // Matches the command received from .js to control the LEDs
                      if(command == "circle"){ //Turns green LED on when the joystick in in the circle position
                          digitalWrite(greenLED, HIGH); // Green on
                          digitalWrite(redLED, LOW); // Red off
                          digitalWrite(yellowLED, LOW); // Yellow off
                      } else if(command == "square"){ //Turns red LED on when the joystick in in the square position
                          digitalWrite(greenLED, LOW); // Green off
                          digitalWrite(redLED, HIGH); // Red on
                          digitalWrite(yellowLED, LOW); // Yellow off
                      } else if(command == "triangle"){ //Turns yellow LED on when the joystick in in the triangle position
                          digitalWrite(redLED, LOW); // Red off
                          digitalWrite(greenLED, LOW); // Green off
                          digitalWrite(yellowLED, HIGH); // Yellow on
                      }
                  }
                  delay(50); // Small delay for stability
              }


            </code></pre>
          </section>

          <section>
          <h2>.js code</h2>
          <pre>
            <code>
            // This is a p5.js sketch that reads joystick values from an Arduino
            // and displays a shape on the canvas based on the joystick position.
            // It also sends the shape name back to the Arduino via serial communication.

            // Import the p5.serialport library
            import "p5.serialport";

            const BAUD_RATE = 9600; // This should match the baud rate in your Arduino sketch

            let port, connectBtn; // Declare global variables

            function setup() {
              setupSerial(); // Run our serial setup function (below)

              // Create a canvas that is the size of our browser window.
              // windowWidth and windowHeight are p5 variables
              createCanvas(windowWidth, windowHeight);

              // p5 text settings. BOLD and CENTER are constants provided by p5.
              // See the "Typography" section in the p5 reference: https://p5js.org/reference/
              textFont("system-ui", 50);
              textStyle(BOLD);
              textAlign(CENTER, CENTER);
            }
            function draw() {
              const portIsOpen = checkPort(); // Check whether the port is open (see checkPort function below)
              if (!portIsOpen) return; // If the port is not open, exit the draw loop

              let str = port.readUntil("\n"); // Read from the port until the newline
              if (str.length == 0) return; // If we didn't read anything, return.

              // Trim the whitespace (the newline) and convert the string to a number
              let values = str.trim().split(","); // Split the string into an array
              if (values.length < 2) return; // If we don't have two values, return

                const xValue = Number(values[0]); // X-axis joystick value
                const yValue = Number(values[1]); // Y-axis joystick value

                // Map the joystick values to the canvas size
                const xPos = map(xValue, 0, 1023, 0, windowWidth);
                const yPos = map(yValue, 0, 1023, 0, windowHeight);

                // Make the background black and the fill white
                background("black");
                fill("white");
              

                let shape = ""; // Variable to hold the shape name

                // Draw shape based on joystick X position
                if (xValue < 400) {
                    fill("green"); // Circle = green
                    ellipse(xPos, yPos, 100, 100); // Draw circle
                    shape = "circle";
                } else if (xValue < 700) {
                    fill("red"); // Square = red
                    rect(xPos - 50, yPos - 50, 100, 100); // Draw square
                    shape = "square";
                } else {
                    fill("yellow"); // Triangle = yellow
                    triangle(xPos, yPos - 50, xPos - 50, yPos + 50, xPos + 50, yPos + 50); // Draw triangle
                    shape = "triangle";
                }



                port.write(shape.toLowerCase() + "\n"); // Send the shape name back to Arduino
                
                // Display the shape name
                fill("white");
                text(`Shape: ${shape}`, windowWidth / 2, 50);
            }
            // Three helper functions for managing the serial connection.

            function setupSerial() {
              port = createSerial();

              // Check to see if there are any ports we have used previously
              let usedPorts = usedSerialPorts();
              if (usedPorts.length > 0) {
                // If there are ports we've used, open the first one
                port.open(usedPorts[0], BAUD_RATE);
              }

              // create a connect button
              connectBtn = createButton("Connect to Arduino");
              connectBtn.position(5, 5); // Position the button in the top left of the screen.
              connectBtn.mouseClicked(onConnectButtonClicked); // When the button is clicked, run the onConnectButtonClicked function
            }

            function checkPort() {
              if (!port.opened()) {
                // If the port is not open, change button text
                connectBtn.html("Connect to Arduino");
                // Set background to gray
                background("gray");
                return false;
              } else {
                // Otherwise we are connected
                connectBtn.html("Disconnect");
                return true;
              }
            }

            function onConnectButtonClicked() {
              // When the connect button is clicked
              if (!port.opened()) {
                // If the port is not opened, we open it
                port.open(BAUD_RATE);
              } else {
                // Otherwise, we close it!
                port.close();
              }
            }


            </code></pre>
          </section>

          <section>
          <h2>Operation Video</h2>
           <video controls>
            <source src='a6video.mp4' type="video/mp4" />
             Your browser does not support the video tag.
           </video>
            <p>Video of my circuit in action. </p>


            <h2>Questions</h2>
            <p>
              I used Microsoft Co-Pilot to help me debug my code when I was trying to understand the functionality of the SW (pin) on the joystick.
              Everytime I included code that had an else statement for the joystick's position when there would be no shapes, it didn't work. Microsoft Co-Pilot was unable
              to help me understand why that was happening, so I ended up just removing that part of the code entirely and it worked. I would've liked to figure out 
              how to make the joystick be at a resting state, but instead, my joystick starts in the square shape with the red LED on. I also used Co-Pilot to help me 
              understand how to read serial commands from p5.js to the Arduino, which I was struggling with at first. It was very helpful at also advising how to approach the joystick's functionality 
              in terms of values 0-1023. This allowed me to determine the best thresholds for when the joystick would be in the center, to the left, and to the right.
            </p>

      </main>
  </body>
</html>